<self:PropGridListEditor xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                         xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                         xmlns:local="clr-namespace:Keysight.OpenTap.Wpf"
                         xmlns:self="clr-namespace:Keysight.OpenTap.Wpf"
                         xmlns:system="clr-namespace:System;assembly=mscorlib"
                         xmlns:tap="clr-namespace:OpenTap;assembly=OpenTap.Engine"
                         x:Name="This" FocusManager.IsFocusScope="True" Focusable="False"
                         FocusManager.FocusedElement="{Binding ElementName=This, Mode=OneTime}">
  <FrameworkElement.Resources>
    <ResourceDictionary>
      <ResourceDictionary.MergedDictionaries>
        <ResourceDictionary Source="/Keysight.OpenTap.Wpf;component/DefaultStyle.xaml"/>
        <ResourceDictionary Source="/Keysight.OpenTap.Wpf;component/Themes/Generic.xaml"/>
      </ResourceDictionary.MergedDictionaries>
    </ResourceDictionary>
  </FrameworkElement.Resources>
  <UIElement.CommandBindings>
    <CommandBinding Command="Paste"/>
    <CommandBinding Command="Copy"/>
    <CommandBinding Command="Cut"/>
    <CommandBinding Command="Delete"/>
  </UIElement.CommandBindings>
  <FrameworkElement.ContextMenu>
    <ContextMenu>
      <MenuItem Command="Copy"/>
      <MenuItem Command="Paste"/>
      <MenuItem Command="Cut"/>
      <MenuItem Command="Delete"/>
    </ContextMenu>
  </FrameworkElement.ContextMenu>
  <Grid Height="{Binding RelativeSource={RelativeSource FindAncestor, AncestorType=ScrollViewer, AncestorLevel=1}, Path=ActualHeight}">
    <Grid.ColumnDefinitions>
      <ColumnDefinition MinWidth="50" Width="auto"/>
      <ColumnDefinition Width="*"/>
    </Grid.ColumnDefinitions>
    <Border MaxWidth="150" Margin="0,5,0,5" BorderThickness="0,0,1,0"
            BorderBrush="{DynamicResource Tap.Window.Background}">
      <Grid Margin="5,5,0,5" Background="{DynamicResource Tap.Panel.Background}">
        <FrameworkElement.Resources>
          <Style TargetType="{x:Type ListBoxItem}" BasedOn="{StaticResource {x:Type ListBoxItem}}">
            <Setter Property="Control.Padding" Value="4,0"/>
            <Setter Property="FrameworkElement.Height" Value="{DynamicResource Tap.DataGrid.RowHeight}"/>
            <Setter Property="Control.VerticalContentAlignment" Value="Center"/>
            <Setter Property="FrameworkElement.ToolTip" Value="{Binding Converter={self:ResourceToolTipConverter}}"/>
          </Style>
          <DataTemplate DataType="{x:Type self:ResourceToolTipViewModel}">
            <StackPanel>
              <TextBlock FontWeight="Bold" Text="{Binding Name}"/>
              <TextBlock>
                Type:
                <TextBlock FontStyle="Italic" Text="{Binding TypeName}"/>
              </TextBlock>
            </StackPanel>
          </DataTemplate>
          <DataTemplate DataType="{x:Type self:ResourceViewModel}">
            <Border>
              <self:TwoFaceBox Unloaded="TwoFaceBox_Unloaded" LostFocus="TwoFaceBox_LostFocus" GotFocus="TwoFaceBox_GotFocus"
                               KeyDown="TwoFaceBox_KeyDown"
                               IsEnabled="{Binding ContentEnabled, RelativeSource={RelativeSource AncestorType=local:PropGridListEditorBase}}"
                               IsHitTestVisible="{Binding IsSelected, RelativeSource={RelativeSource AncestorType=ListBoxItem}}"
                               FocusedText="{Binding Name, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}">
                <self:TwoFaceBox.UnfocusedContent>
                  <TextBlock Name="txt" VerticalAlignment="Center">
                    <TextBlock MinWidth="50" MaxWidth="140" TextTrimming="CharacterEllipsis"
                               Text="{Binding Name, UpdateSourceTrigger=PropertyChanged}"/>
                  </TextBlock>
                </self:TwoFaceBox.UnfocusedContent>
              </self:TwoFaceBox>
            </Border>
          </DataTemplate>
          <DataTemplate DataType="{x:Type self:EnabledResourceViewModel}">
            <StackPanel Orientation="Horizontal">
              <CheckBox IsEnabled="{Binding ContentEnabled, RelativeSource={RelativeSource AncestorType=local:PropGridListEditorBase}}"
                        IsChecked="{Binding IsEnabled}"/>
              <self:TwoFaceBox Unloaded="TwoFaceBox_Unloaded" LostFocus="TwoFaceBox_LostFocus" GotFocus="TwoFaceBox_GotFocus"
                               KeyDown="TwoFaceBox_KeyDown"
                               IsEnabled="{Binding ContentEnabled, RelativeSource={RelativeSource AncestorType=local:PropGridListEditorBase}}"
                               IsHitTestVisible="{Binding IsSelected, RelativeSource={RelativeSource AncestorType=ListBoxItem}}"
                               FocusedText="{Binding Name, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}">
                <self:TwoFaceBox.UnfocusedContent>
                  <TextBlock VerticalAlignment="Center" HorizontalAlignment="Left" MinWidth="50" MaxWidth="115"
                             TextTrimming="CharacterEllipsis" Text="{Binding Name, UpdateSourceTrigger=PropertyChanged}"/>
                </self:TwoFaceBox.UnfocusedContent>
              </self:TwoFaceBox>
            </StackPanel>
          </DataTemplate>
        </FrameworkElement.Resources>
        <Grid.RowDefinitions>
          <RowDefinition Height="*"/>
          <RowDefinition Height="auto"/>
        </Grid.RowDefinitions>
        <ListBox Name="lstBox" Background="Transparent" SelectionMode="Extended" Focusable="True"
                 ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                 ItemsSource="{Binding List, ElementName=This, Mode=OneWay}">
          <ItemsControl.ItemsPanel>
            <ItemsPanelTemplate>
              <VirtualizingStackPanel/>
            </ItemsPanelTemplate>
          </ItemsControl.ItemsPanel>
          <ItemsControl.ItemTemplate>
            <DataTemplate DataType="tap:IResource">
              <ContentPresenter Content="{Binding Converter={self:EnabledResourceConverter}}"/>
            </DataTemplate>
          </ItemsControl.ItemTemplate>
        </ListBox>
        <StackPanel Name="buttonPanel" Grid.Row="1" HorizontalAlignment="Stretch" Margin="3"
                    Visibility="{Binding Converter={self:ComponentSettingToVisibility}}">
          <Button Content="+" Margin="2" Padding="20,2" ToolTip="Add an Item" TextBlock.FontSize="15"
                  IsEnabled="{Binding ContentEnabled, ElementName=This}"/>
          <Button Content="-" Margin="2" Padding="20,2" Command="Delete" ToolTip="Remove selected Item"
                  TextBlock.FontSize="15"/>
        </StackPanel>
      </Grid>
    </Border>
    <Border BorderThickness="3,0,0,0" Grid.Column="1">
      <Grid>
        <Grid.RowDefinitions>
          <RowDefinition Height="auto"/>
          <RowDefinition/>
        </Grid.RowDefinitions>
        <Label HorizontalContentAlignment="Center" Margin="0,5,5,3"
               Tag="{Binding SelectedItems.Count, ElementName=lstBox}"
               ToolTip="{Binding SelectedItem, Converter={self:DescriptionConverter}, ElementName=lstBox}">
          <FrameworkElement.Style>
            <Style BasedOn="{StaticResource {x:Type Label}}" TargetType="{x:Type Label}">
              <Setter Property="UIElement.Opacity" Value="0.5"/>
              <Setter Property="ContentControl.Content" Value=" "/>
              <Style.Triggers>
                <Trigger Property="FrameworkElement.Tag">
                  <Trigger.Value>
                    <system:Int32>1</system:Int32>
                  </Trigger.Value>
                  <Setter Property="UIElement.Opacity" Value="1"/>
                  <Setter Property="ContentControl.Content"
                          Value="{Binding SelectedItem, Converter={self:DisplayNameAttributeConverter}, ElementName=lstBox}"/>
                </Trigger>
                <Trigger Property="FrameworkElement.Tag">
                  <Trigger.Value>
                    <system:Int32>0</system:Int32>
                  </Trigger.Value>
                  <Setter Property="UIElement.Opacity" Value="0"/>
                </Trigger>
              </Style.Triggers>
            </Style>
          </FrameworkElement.Style>
        </Label>
        <self:PropGrid x:Name="propertyGrid" PropertyEdited="propGrid_PropertyEdited" Grid.Row="1"
                       HorizontalAlignment="Stretch" MultiSelectEnabled="True"
                       ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                       ContentEnabled="{Binding ContentEnabled, ElementName=This}"
                       UndoEnabled="{Binding UndoEnabled, ElementName=This}"
                       DataContext="{Binding SelectedItems, ElementName=lstBox, Mode=OneWay}">
          <FrameworkElement.Style>
            <Style TargetType="{x:Type Control}">
              <Setter Property="FrameworkElement.FocusVisualStyle" Value="{x:Null}"/>
              <Setter Property="FrameworkElement.Margin" Value="0,0,5,0"/>
            </Style>
          </FrameworkElement.Style>
        </self:PropGrid>
        <Border Grid.RowSpan="2" Padding="15,0,0,8" HorizontalAlignment="Left" VerticalAlignment="Bottom"
                Width="159">
          <TextBlock Name="clickPlusTextBlock">
            <FrameworkElement.Style>
              <Style TargetType="{x:Type TextBlock}" BasedOn="{StaticResource Tap.TextBlock.HintStyle}">
                <Setter Property="UIElement.Visibility" Value="Hidden"/>
              </Style>
            </FrameworkElement.Style>
            Click '+' to add an item.
          </TextBlock>
        </Border>
      </Grid>
    </Border>
  </Grid>
</self:PropGridListEditor>