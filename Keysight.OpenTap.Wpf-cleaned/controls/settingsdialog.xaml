<controls:SettingsDialog xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                         xmlns:ui="clr-namespace:Keysight.Ccl.Wsl.UI;assembly=Keysight.Ccl.Wsl"
                         xmlns:WslManagers="clr-namespace:Keysight.Ccl.Wsl.UI.Managers;assembly=Keysight.Ccl.Wsl"
                         xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                         xmlns:controls="clr-namespace:Keysight.OpenTap.Wpf"
                         xmlns:sys="clr-namespace:System;assembly=mscorlib"
                         xmlns:ports="clr-namespace:System.IO.Ports;assembly=System"
                         Name="this" Title="Settings" Height="700" Width="600" MinHeight="300" MinWidth="350"
                         Icon="{DynamicResource TapIcon}" ResizeMode="CanResize" SizeToContent="Manual"
                         WindowStartupLocation="CenterOwner" Background="{DynamicResource Tap.Window.Background}"
                         AutomationProperties.AutomationId="SettingsWindow"
                         WslManagers:HelpManager.HelpLink="EditorHelp.chm::/Configurations/Readme.html" HasHelpButton="true"
                         HasCloseButton="False">
  <UIElement.CommandBindings>
    <CommandBinding Command="Copy"/>
    <CommandBinding Command="Paste"/>
    <CommandBinding Command="Cut"/>
    <CommandBinding Command="Delete"/>
  </UIElement.CommandBindings>
  <FrameworkElement.Resources>
    <ResourceDictionary>
      <ResourceDictionary.MergedDictionaries>
        <ResourceDictionary Source="/Keysight.OpenTap.Wpf;component/DefaultStyle.xaml"/>
        <ResourceDictionary Source="/Keysight.OpenTap.Wpf;component/Themes/Generic.xaml"/>
      </ResourceDictionary.MergedDictionaries>
      <controls:DisplayNameAttributeConverter x:Key="displayNameAttributeConverter"/>
      <controls:SettingsTemplateSelector x:Key="settingsTemplateSelector"/>
    </ResourceDictionary>
  </FrameworkElement.Resources>
  <Grid>
    <Grid.RowDefinitions>
      <RowDefinition Height="*"/>
      <RowDefinition Height="Auto"/>
    </Grid.RowDefinitions>
    <Grid Margin="2" Background="{DynamicResource Tap.Panel.Background}">
      <Grid.RowDefinitions>
        <RowDefinition Height="Auto"/>
        <RowDefinition Height="Auto"/>
        <RowDefinition Height="*"/>
      </Grid.RowDefinitions>
      <ToolBar Grid.Row="1"/>
      <Grid Row="1" Margin="2" Visibility="{Binding Profile, Converter={controls:VisibilityConverter}}"
            IsEnabled="{Binding Settings.AllowEdit}">
        <Grid.ColumnDefinitions>
          <ColumnDefinition Width="Auto"/>
          <ColumnDefinition Width="*"/>
          <ColumnDefinition Width="Auto"/>
          <ColumnDefinition Width="Auto"/>
          <ColumnDefinition Width="Auto"/>
          <ColumnDefinition Width="Auto"/>
        </Grid.ColumnDefinitions>
        <Label Background="Transparent" VerticalAlignment="Center" Content="Profile:"/>
        <ComboBox Name="configSetSelector" HorizontalAlignment="Stretch" Grid.Column="1"
                  VerticalContentAlignment="Center" BorderThickness="1" DisplayMemberPath="Name"
                  IsEnabled="{Binding Settings.AllowEdit}"
                  ItemsSource="{Binding ConfigurationSets, ElementName=this}"/>
        <Button Grid.Column="2" Margin="2,0" ToolTip="Create new settings profile.">
          <ContentControl.Content>
            <Rectangle Width="16" Height="16" SnapsToDevicePixels="True"
                       Fill="{DynamicResource Control.Static.Foreground}">
              <UIElement.OpacityMask>
                <ImageBrush ImageSource="../Images/doc_new.png"/>
              </UIElement.OpacityMask>
            </Rectangle>
          </ContentControl.Content>
        </Button>
        <Button x:Name="buttonDelete" Grid.Column="3" Margin="2,0" ToolTip="Delete selected settings profile.">
          <ContentControl.Content>
            <Rectangle SnapsToDevicePixels="True" Width="16" Height="16"
                       Fill="{DynamicResource Control.Static.Foreground}">
              <UIElement.OpacityMask>
                <ImageBrush ImageSource="../Images/doc_delete.png"/>
              </UIElement.OpacityMask>
            </Rectangle>
          </ContentControl.Content>
        </Button>
        <Button Grid.Column="4" Margin="2,0" ToolTip="Import settings profile">
          <ContentControl.Content>
            <Rectangle Width="16" Height="16" SnapsToDevicePixels="True"
                       Fill="{DynamicResource Control.Static.Foreground}">
              <UIElement.OpacityMask>
                <ImageBrush ImageSource="../Images/doc_import.png"/>
              </UIElement.OpacityMask>
            </Rectangle>
          </ContentControl.Content>
        </Button>
        <Button Grid.Column="5" Margin="2,0" ToolTip="Export selected settings profile">
          <ContentControl.Content>
            <Rectangle Width="16" Height="16" SnapsToDevicePixels="True"
                       Fill="{DynamicResource Control.Static.Foreground}">
              <UIElement.OpacityMask>
                <ImageBrush ImageSource="../Images/doc_export.png"/>
              </UIElement.OpacityMask>
            </Rectangle>
          </ContentControl.Content>
        </Button>
      </Grid>
      <TabControl Name="settingsTabs" Grid.Row="2" TabStripPlacement="Top"
                  ContentTemplateSelector="{StaticResource settingsTemplateSelector}"
                  AutomationProperties.AutomationId="GlobalSettingsTabControl" ItemsSource="{Binding SettingsList}"
                  SelectedIndex="{Binding SelectedIndex}">
        <ItemsControl.ItemTemplate>
          <DataTemplate>
            <StackPanel Orientation="Horizontal">
              <TextBlock ToolTip="{Binding Converter={controls:DescriptionConverter}, Mode=OneWay}"
                         Text="{Binding Converter={StaticResource displayNameAttributeConverter}, Mode=OneWay}"/>
              <ComboBox Name="providerSelector" ToolTip="Select which way to display this settings tab." Width="14"
                        Height="14" Margin="5,0,-5,0"
                        SelectedItem="{Binding Converter={controls:TypeOfConverter}, Mode=OneWay}">
                <Control.Template>
                  <ControlTemplate TargetType="{x:Type ComboBox}">
                    <Grid>
                      <VisualStateManager.VisualStateGroups>
                        <VisualStateGroup x:Name="CommonStates">
                          <VisualState x:Name="Normal"/>
                          <VisualState x:Name="MouseOver"/>
                          <VisualState x:Name="Disabled"/>
                        </VisualStateGroup>
                      </VisualStateManager.VisualStateGroups>
                      <ToggleButton x:Name="ToggleButton" Grid.Column="2" ClickMode="Press" Focusable="false" Padding="0"
                                    Background="Transparent"
                                    IsChecked="{Binding IsDropDownOpen, Mode=TwoWay, RelativeSource={RelativeSource TemplatedParent}}">
                        <Control.Template>
                          <ControlTemplate TargetType="{x:Type ToggleButton}">
                            <Border Name="border" Background="Transparent" Width="14" Height="14">
                              <Path Name="arrow" HorizontalAlignment="Center" VerticalAlignment="Center" Width="8" Height="4"
                                    StrokeThickness="0" Data="M 0,0 L 4,4 8,0 0,0 Z" Fill="{DynamicResource ComboBox.Static.Glyph}"/>
                            </Border>
                            <ControlTemplate.Triggers>
                              <Trigger Property="UIElement.IsMouseOver" Value="true">
                                <Setter TargetName="border" Value="{DynamicResource Tap.Panel.Background}" Property="Border.Background"/>
                              </Trigger>
                            </ControlTemplate.Triggers>
                          </ControlTemplate>
                        </Control.Template>
                      </ToggleButton>
                      <Popup x:Name="Popup" AllowsTransparency="True" Focusable="False"
                             IsOpen="{TemplateBinding ComboBox.IsDropDownOpen}" Placement="Bottom" PopupAnimation="Fade">
                        <Grid x:Name="DropDown" Background="{DynamicResource Tap.Panel.Background}"
                              MaxHeight="{TemplateBinding ComboBox.MaxDropDownHeight}"
                              MinWidth="{TemplateBinding FrameworkElement.ActualWidth}" SnapsToDevicePixels="True">
                          <Border x:Name="DropDownBorder" BorderThickness="1" CornerRadius="0"/>
                          <ScrollViewer Margin="2" SnapsToDevicePixels="True">
                            <StackPanel KeyboardNavigation.DirectionalNavigation="Contained" IsItemsHost="True"
                                        TextBlock.Foreground="{DynamicResource Control.Static.Foreground}"/>
                          </ScrollViewer>
                        </Grid>
                      </Popup>
                    </Grid>
                    <ControlTemplate.Triggers>
                      <Trigger Property="ItemsControl.HasItems" Value="false">
                        <Setter TargetName="DropDownBorder" Property="FrameworkElement.MinHeight" Value="95"/>
                      </Trigger>
                    </ControlTemplate.Triggers>
                  </ControlTemplate>
                </Control.Template>
                <ItemsControl.ItemTemplate>
                  <DataTemplate>
                    <TextBlock Margin="0,0,5,0" Text="{Binding Converter={controls:FullDisplayAttributeConverter}}"
                               ToolTip="{Binding Converter={controls:DescriptionConverter}}"/>
                  </DataTemplate>
                </ItemsControl.ItemTemplate>
              </ComboBox>
            </StackPanel>
            <DataTemplate.Triggers>
              <DataTrigger Value="False" Binding="{Binding IsSelected, RelativeSource={RelativeSource AncestorType=TabItem}}">
                <Setter TargetName="providerSelector" Property="UIElement.Visibility" Value="Hidden"/>
              </DataTrigger>
            </DataTemplate.Triggers>
          </DataTemplate>
        </ItemsControl.ItemTemplate>
      </TabControl>
      <Label Grid.RowSpan="1" Background="{DynamicResource Tap.Window.Background}" BorderThickness="0,0,0,1"
             BorderBrush="Red" HorizontalAlignment="Stretch" VerticalAlignment="Top"
             HorizontalContentAlignment="Center" Height="30" FontWeight="Bold" FontSize="14"
             VerticalContentAlignment="Center"
             Visibility="{Binding Settings.AllowEdit, Converter={controls:VisibilityConverter}, ConverterParameter={x:Static Visibility.Visible}}">
        <FrameworkElement.ToolTip>
          <TextBlock>
            This is most likely due to the test plan running or the resources being opened.
            <LineBreak/>
            Wait for the test plan to finish, abort test plan execution, or release the resources.
          </TextBlock>
        </FrameworkElement.ToolTip>
        Settings in Use, Editing Not Allowed
      </Label>
    </Grid>
    <StackPanel Margin="0,2,0,1" Grid.Row="1" Orientation="Horizontal" HorizontalAlignment="Right">
      <Button Name="OkButton" Content="OK" Width="60" Margin="3,0,4,2"/>
      <Button Name="CancelButton" Content="Cancel" Width="70" Margin="3,0,2,2"/>
    </StackPanel>
  </Grid>
</controls:SettingsDialog>