<gui:InstrumentStatus xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                      xmlns:sys="clr-namespace:System;assembly=mscorlib"
                      xmlns:gui="clr-namespace:Keysight.OpenTap.Gui"
                      xmlns:controls="clr-namespace:Keysight.OpenTap.Wpf;assembly=Keysight.OpenTap.Wpf"
                      Name="e" DataContext="{Binding RelativeSource={RelativeSource Mode=Self}}">
  <FrameworkElement.Resources>
    <Style TargetType="{x:Type gui:StatusButton}" BasedOn="{StaticResource {x:Type Button}}"/>
    <SolidColorBrush x:Key="Button.Static.Background" Color="Transparent"/>
  </FrameworkElement.Resources>
  <ScrollViewer MaxHeight="100" VerticalScrollBarVisibility="Auto">
    <ItemsControl KeyboardNavigation.IsTabStop="False" IsTabStop="False" Focusable="False" Margin="5,0,5,0"
                  ItemsSource="{Binding ResourceLists, ElementName=e}">
      <ItemsControl.ItemsPanel>
        <ItemsPanelTemplate>
          <WrapPanel Orientation="Horizontal"/>
        </ItemsPanelTemplate>
      </ItemsControl.ItemsPanel>
      <ItemsControl.ItemTemplate>
        <DataTemplate>
          <Grid Name="panel" ToolTip="{Binding Converter={controls:DescriptionConverter}}">
            <Grid.ColumnDefinitions>
              <ColumnDefinition Width="auto"/>
              <ColumnDefinition Width="auto"/>
              <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>
            <Button Name="ResourceSettingsOpenButton" Grid.Column="0" ToolTip="Open settings to add new resources."
                    Command="controls:TapSettings.Open" CommandParameter="{Binding}">
              <TextBlock Name="ResourceSettingsName" Margin="3,0" FontWeight="Bold" VerticalAlignment="Center"
                         Text="{Binding Converter={controls:ComponentSettingsNameConverter}}"/>
            </Button>
            <Button Name="addbtn" Grid.Column="1" VerticalAlignment="Stretch"
                    ToolTip="Open settings to add new resources." Command="controls:TapSettings.Open"
                    Visibility="Collapsed" BorderThickness="0" Margin="0,0,3,0" IsTabStop="False"
                    CommandParameter="{Binding}">
              <TextBlock Text="Add New" TextDecorations="Underline" VerticalAlignment="Center"/>
            </Button>
            <ItemsControl Grid.Column="2" Margin="0,0,9,0" IsTabStop="False" ItemsSource="{Binding}">
              <ItemsControl.ItemsPanel>
                <ItemsPanelTemplate>
                  <WrapPanel Orientation="Horizontal"/>
                </ItemsPanelTemplate>
              </ItemsControl.ItemsPanel>
              <ItemsControl.ItemTemplate>
                <DataTemplate>
                  <gui:StatusButton x:Name="btn" Loaded="loadCommandParameter" Command="controls:TapSettings.Open"
                                    VerticalAlignment="Center" BorderThickness="0" Margin="0,0,4,0" IsTabStop="False"
                                    Tag="{Binding RelativeSource={RelativeSource AncestorType={x:Type gui:InstrumentStatus}}}">
                    <FrameworkElement.ToolTip>
                      <TextBlock>
                        <TextBlock Text="{Binding Converter={controls:DisplayNameAttributeConverter}}"/>
                        <LineBreak/>
                        <TextBlock>
                          Left-Click to configure.
                        </TextBlock>
                        <LineBreak/>
                        <TextBlock>
                          Right-Click for additional actions.
                        </TextBlock>
                      </TextBlock>
                    </FrameworkElement.ToolTip>
                    <FrameworkElement.ContextMenu>
                      <ContextMenu Tag="{Binding Path=PlacementTarget.Tag, RelativeSource={RelativeSource Self}}"/>
                    </FrameworkElement.ContextMenu>
                    <StackPanel Orientation="Horizontal">
                      <TextBlock VerticalAlignment="Center" TextTrimming="CharacterEllipsis" MaxWidth="140" Text="{Binding Name}"/>
                      <Grid>
                        <Ellipse Name="indicator" Margin="4,0,3,0" Width="8" Height="8" Fill="Gray" VerticalAlignment="Center"/>
                        <Ellipse Name="indicator2" Margin="4,0,3,0" Width="8" Height="8" Fill="Transparent"
                                 VerticalAlignment="Center"/>
                      </Grid>
                    </StackPanel>
                    <FrameworkElement.Triggers>
                      <EventTrigger RoutedEvent="gui:StatusButton.Activity">
                        <EventTrigger.Actions>
                          <BeginStoryboard>
                            <Storyboard TargetName="indicator2" TargetProperty="Fill.Color">
                              <ColorAnimation To="LightGreen" Duration="0:0:0.0"/>
                              <ColorAnimation To="Transparent" Duration="0:0:0.1"/>
                            </Storyboard>
                          </BeginStoryboard>
                        </EventTrigger.Actions>
                      </EventTrigger>
                    </FrameworkElement.Triggers>
                  </gui:StatusButton>
                  <DataTemplate.Triggers>
                    <DataTrigger Value="True" Binding="{Binding IsConnected}">
                      <Setter TargetName="indicator" Property="Shape.Fill" Value="Green"/>
                    </DataTrigger>
                  </DataTemplate.Triggers>
                </DataTemplate>
              </ItemsControl.ItemTemplate>
            </ItemsControl>
          </Grid>
          <DataTemplate.Triggers>
            <DataTrigger Value="0" Binding="{Binding Count}">
              <DataTrigger.Setters>
                <Setter TargetName="addbtn" Property="UIElement.Visibility" Value="Visible"/>
              </DataTrigger.Setters>
            </DataTrigger>
          </DataTemplate.Triggers>
        </DataTemplate>
      </ItemsControl.ItemTemplate>
    </ItemsControl>
  </ScrollViewer>
</gui:InstrumentStatus>